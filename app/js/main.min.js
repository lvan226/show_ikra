$(function () {

  // Таймер обратного отсчета
  timeend = new Date(2020, 3, 1, 0, 50, 0);
  // IE и FF по разному отрабатывают getYear()
  // timeend = new Date(timeend.getYear()>1900?(timeend.getYear()+1):(timeend.getYear()+1901),0,1);
  // для задания обратного отсчета до определенной даты укажите дату в формате:
  // timeend= new Date(ГОД, МЕСЯЦ-1, ДЕНЬ);
  // Для задания даты с точностью до времени укажите дату в формате:
  // timeend= new Date(ГОД, МЕСЯЦ-1, ДЕНЬ, ЧАСЫ-1, МИНУТЫ);
  let day = document.querySelector('.counter-day');
  let hour = document.querySelector('.counter-hour');
  let min = document.querySelector('.counter-min');
  let sec = document.querySelector('.counter-sec');

  function time() {
    today = new Date();
    today = Math.floor((timeend - today) / 1000);
    tsec = today % 60;
    today = Math.floor(today / 60);
    if (tsec < 10) tsec = '0' + tsec;
    tmin = today % 60;
    today = Math.floor(today / 60);
    if (tmin < 10) tmin = '0' + tmin;
    thour = today % 24;
    today = Math.floor(today / 24);
    timestr = today + " дней " + thour + " часов " + tmin + " минут " + tsec + " секунд";
    // document.querySelector('.counter').innerHTML=timestr;
    day.firstElementChild.innerHTML = today.toString()[0];
    day.lastElementChild.innerHTML = today.toString()[1];
    if (thour <= 9) {
      hour.firstElementChild.innerHTML = '0';
      hour.lastElementChild.innerHTML = thour.toString()[0];
    } else {
      hour.firstElementChild.innerHTML = thour.toString()[0];
      hour.lastElementChild.innerHTML = thour.toString()[1];
    }
    min.firstElementChild.innerHTML = tmin.toString()[0];
    min.lastElementChild.innerHTML = tmin.toString()[1];

    sec.firstElementChild.innerHTML = tsec.toString()[0];
    sec.lastElementChild.innerHTML = tsec.toString()[1];
    window.setTimeout(time, 1000);
  }

  $('body').on('load', time());
  // Таймер обратного отсчета конец

  // Слайдер галереи
  $('.gallery__slider').slick({
    slidesToShow: 1,
    dots: true,
    nextArrow: '<button class="slick-next slick-arrow" aria-label="Next" type="button"></button>',
    prevArrow: '<button class="slick-prev slick-arrow" aria-label="Prev" type="button"></button>',
  });
  // Конец слайдера галереи

  // Меню гамбургер начало
  $('.menu-burger').on('click', function () {
    $('.menu-burger').toggleClass('active');
    $('.menu__list').toggleClass('active');
    $('body').toggleClass('hidden-y');
  });
  $('.close').on('click', function () {
    $('.menu-burger').toggleClass('active');
    $('.menu__list').toggleClass('active');
    $('body').toggleClass('hidden-y');
  });
  // Меню гамбургер конец




  var h_hght = $('.banner').height();
  var h_mrg = 0; // отступ когда шапка уже не видна
  menuFixed(h_hght, h_mrg);

  // Ресайз окна
  var rtime;
  var timeout = false;
  var delta = 200;
  $(window).resize(function () {
    rtime = new Date();
    if (timeout === false) {
      timeout = true;
      setTimeout(resizeend, delta);
    }
  });

  function resizeend() {
    if (new Date() - rtime < delta) {
      setTimeout(resizeend, delta);
    } else {
      timeout = false;
      // alert('Done resizing');
      h_hght = $('.banner').height();
      var elem = $('#top_nav');
      var top = $(this).scrollTop();
      if (top + h_mrg < h_hght) {
        elem.css('top', (h_hght - top));
        elem.css('background', "transparent")
      } else {
        elem.css('top', h_mrg);
        elem.css('background', "#fff")
      }
      menuFixed(h_hght, h_mrg);
    }
  }
  // Ресайз окна конец



  // Слайдер афиши
  $('.poster__slider').slick({
    slidesToShow: 3,
    dots: true,
    nextArrow: '<button class="slick-next slick-arrow" aria-label="Next" type="button"></button>',
    prevArrow: '<button class="slick-prev slick-arrow" aria-label="Prev" type="button"></button>',
    variableWidth: true,
    centerMode: true
  });
  // Конец слайдера афиши

  $('.btn-modal').on('click', function () {
    $("#modal").addClass('active');
    $('.overlay').addClass('active');
    $('body').addClass('hidden-y');
  });
  $('.overlay').on('click', function () {
    $("#modal").removeClass('active');
    $('.overlay').removeClass('active');
    $('body').removeClass('hidden-y');
  });


});


// Функция срабатывает при прокрутке экрана
function menuFixed(one, two) {
  $(window).scroll(function () {
    var top = $(this).scrollTop();
    var elem = $('#top_nav');
    var h_hght = one;
    var h_mrg = two;
    if (top + h_mrg < h_hght) {
      elem.css('top', (h_hght - top));
      elem.css('background', "transparent")
    } else {
      elem.css('top', h_mrg);
      elem.css('background', "#fff")
    }
  });
}